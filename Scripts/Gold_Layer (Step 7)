
We can use Primary key which we got but sometimes we dont have primary key for dimension table then we can create SURROGATE KEY which is sustem generated unique identifier assigned to each record in a table----------> we use this to connect our data model 
we can use DDL based generation or query based Window function (row_number)

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------- Customer Information Table--------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

--- We have 2 columns for gender so we are need to identify if anything is not consistent and what is the master record for gender 
WITH full_cust_info as(
SELECT cc.cst_id, cc.cst_key,cc.cst_firstname,cc.cst_lastname,cc.cst_marital_status,cc.cst_gndr,cc.cst_create_date
,ec.bdate,ec.gen,
el.cntry
FROM silver.crm_cust_info cc
LEFT JOIN silver.erp_cust_az12 ec on
cc.cst_key = ec.cid
LEFT JOIN silver.erp_loc_a101 el on
cc.cst_key = el.cid)

SELECT DISTINCT cst_gndr,gen
FROM full_cust_info ;
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------FInal Customer INformation after adjusting gender to use crested as virtual table with VIEW--------------------------------------------------------------------

CREATE VIEW gold.dim_customers AS 
SELECT 
		cc.cst_id AS customer_id, 
		cc.cst_key AS customer_number,
		cc.cst_firstname AS firstname,
		cc.cst_lastname AS last_name,
		cc.cst_marital_status AS marital_status,
		COALESCE(CASE WHEN
					cst_gndr = 'n/a' THEN gen
					ELSE cst_gndr
					END, 'n/a') AS gender,cc.cst_create_date AS create_date,
		ec.bdate AS birthdate,
		el.cntry AS country
FROM silver.crm_cust_info cc
LEFT JOIN silver.erp_cust_az12 ec on
cc.cst_key = ec.cid
LEFT JOIN silver.erp_loc_a101 el on
cc.cst_key = el.cid;

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------Dimension Products -------------------------------------------------------

CREATE VIEW gold.dim_products AS
SELECT
    pn.prd_id       AS product_id,
    pn.prd_key      AS product_number,
    pn.prd_nm       AS product_name,
    pn.cat_id       AS category_id,
    pc.cat          AS category,
    pc.subcat       AS subcategory,
    pc.maintenance  AS maintenance,
    pn.prd_cost     AS cost,
    pn.prd_line     AS product_line,
    pn.prd_start_dt AS start_date
FROM silver.crm_prd_info pn
LEFT JOIN silver.erp_px_cat_g1v2 pc
    ON pn.cat_id = pc.id;

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------Create Sales Data-------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE VIEW gold.fact_sales AS
SELECT
    sls_ord_num  AS order_number,
    sls_prd_key AS product_key,
    sls_cust_id AS customer_key,
    sls_order_dt AS order_date,
    sls_ship_dt  AS shipping_date,
    sls_due_dt   AS due_date,
    sls_sales    AS sales_amount,
    sls_quantity AS quantity,
    sls_price    AS price
FROM silver.crm_sales_details;


